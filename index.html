<!DOCTYPE html>
<html>
<head>
    <title>QR Kod Okuyucu</title>
    <style>
        /* Minimal stiller */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #camera-container { position: relative; width: 300px; margin: 0 auto; }
        video { width: 100%; }
        canvas { position: absolute; top: 0; left: 0; }
        #controls { display: flex; justify-content: space-between; margin: 10px 0; }
        #list { max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; }
        #list li { padding: 2px 5px; cursor: pointer; }
        #list li:hover { background-color: #f0f0f0; }
        #keypad { display: none; position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: #fff; border: 1px solid #ccc; padding: 10px; }
        #keypad button { width: 50px; height: 50px; margin: 5px; font-size: 18px; }
    </style>
</head>
<body>

<div id="camera-container">
    <video id="video" autoplay playsinline></video>
    <canvas id="overlay"></canvas>
</div>

<div id="controls">
    <div>
        <input type="checkbox" id="continuous" /> <label for="continuous">Sürekli Oku</label>
        <button id="readQR">QR Oku</button>
    </div>
    <div>
        <label>Genişlik</label>
        <input type="range" id="widthSlider" min="50" max="600" value="150" />
    </div>
    <div>
        <label>Yükseklik</label>
        <input type="range" id="heightSlider" min="50" max="600" value="80" />
    </div>
</div>

<ul id="list"></ul>
<div>
    <button id="add">Ekle</button>
    <button id="undo">Geri Al</button>
    <button id="share">Paylaş</button>
    <button id="clear">Temizle</button>
</div>

<div id="keypad">
    <!-- Tuş takımı -->
    <div id="keypadDisplay"></div>
    <div>
        <button class="keypadBtn">1</button>
        <button class="keypadBtn">2</button>
        <button class="keypadBtn">3</button>
        <button class="keypadBtn">-</button>
    </div>
    <div>
        <button class="keypadBtn">4</button>
        <button class="keypadBtn">5</button>
        <button class="keypadBtn">6</button>
        <button id="keypadBackspace">←</button>
    </div>
    <div>
        <button class="keypadBtn">7</button>
        <button class="keypadBtn">8</button>
        <button class="keypadBtn">9</button>
        <button id="keypadClear">C</button>
    </div>
    <div>
        <button class="keypadBtn">0</button>
        <button id="keypadEnter">Enter</button>
    </div>
</div>

<script>
    // JavaScript kodu
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const canvas = overlay.getContext('2d');
    const widthSlider = document.getElementById('widthSlider');
    const heightSlider = document.getElementById('heightSlider');
    const continuousCheckbox = document.getElementById('continuous');
    const readQRButton = document.getElementById('readQR');
    const list = document.getElementById('list');
    const keypad = document.getElementById('keypad');
    const keypadDisplay = document.getElementById('keypadDisplay');
    const keypadButtons = document.querySelectorAll('.keypadBtn');
    const keypadEnter = document.getElementById('keypadEnter');
    const keypadBackspace = document.getElementById('keypadBackspace');
    const keypadClear = document.getElementById('keypadClear');
    const addButton = document.getElementById('add');
    const undoButton = document.getElementById('undo');
    const shareButton = document.getElementById('share');
    const clearButton = document.getElementById('clear');
    let redRectWidth = parseInt(widthSlider.value);
    let redRectHeight = parseInt(heightSlider.value);
    let scanning = false;
    let dataList = [];

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(stream => {
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                video.play();
                overlay.width = video.videoWidth;
                overlay.height = video.videoHeight;
                drawRedRectangle();
            };
        })
        .catch(err => {
            console.error("Kameraya erişim hatası: ", err);
        });

    function drawRedRectangle() {
        canvas.clearRect(0, 0, overlay.width, overlay.height);
        canvas.strokeStyle = 'red';
        canvas.lineWidth = 2;
        const x = (overlay.width - redRectWidth) / 2;
        const y = (overlay.height - redRectHeight) / 2;
        canvas.strokeRect(x, y, redRectWidth, redRectHeight);
    }

    widthSlider.addEventListener('input', () => {
        redRectWidth = parseInt(widthSlider.value);
        drawRedRectangle();
    });

    heightSlider.addEventListener('input', () => {
        redRectHeight = parseInt(heightSlider.value);
        drawRedRectangle();
    });

    function scanQRCode() {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            overlay.width = video.videoWidth;
            overlay.height = video.videoHeight;
            canvas.drawImage(video, 0, 0, overlay.width, overlay.height);
            const x = (overlay.width - redRectWidth) / 2;
            const y = (overlay.height - redRectHeight) / 2;
            const imageData = canvas.getImageData(x, y, redRectWidth, redRectHeight);
            // jsQR ile QR kodu tarama
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            if (code) {
                dataList.push(code.data);
                updateList();
            }
        }
        if (continuousCheckbox.checked) {
            requestAnimationFrame(scanQRCode);
        } else {
            scanning = false;
        }
    }

    readQRButton.addEventListener('click', () => {
        if (!scanning) {
            scanning = true;
            scanQRCode();
        }
    });

    continuousCheckbox.addEventListener('change', () => {
        if (continuousCheckbox.checked) {
            scanning = true;
            scanQRCode();
        } else {
            scanning = false;
        }
    });

    function updateList() {
        list.innerHTML = '';
        dataList.forEach((data, index) => {
            const li = document.createElement('li');
            li.textContent = data;
            li.contentEditable = true;
            li.addEventListener('input', (e) => {
                dataList[index] = e.target.textContent;
            });
            list.appendChild(li);
        });
    }

    addButton.addEventListener('click', () => {
        keypadDisplay.textContent = '';
        keypad.style.display = 'block';
    });

    keypadButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            keypadDisplay.textContent += btn.textContent;
        });
    });

    keypadEnter.addEventListener('click', () => {
        if (keypadDisplay.textContent) {
            dataList.push(keypadDisplay.textContent);
            updateList();
        }
        keypad.style.display = 'none';
    });

    keypadBackspace.addEventListener('click', () => {
        keypadDisplay.textContent = keypadDisplay.textContent.slice(0, -1);
    });

    keypadClear.addEventListener('click', () => {
        keypadDisplay.textContent = '';
    });

    undoButton.addEventListener('click', () => {
        dataList.pop();
        updateList();
    });

    clearButton.addEventListener('click', () => {
        dataList = [];
        updateList();
    });

    shareButton.addEventListener('click', () => {
        const dataStr = dataList.join('\n');
        if (navigator.share) {
            navigator.share({ text: dataStr });
        } else {
            alert("Paylaşma özelliği desteklenmiyor.");
        }
    });

    // Tuş takımını kapatmak için
    window.addEventListener('click', (e) => {
        if (e.target == keypad) {
            keypad.style.display = 'none';
        }
    });
</script>

<!-- jsQR kütüphanesi -->
<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>

</body>
</html>
